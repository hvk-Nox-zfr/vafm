<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration â€“ VAFM</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link rel="stylesheet" href="admin.css">
</head>
<body>

<!-- ðŸ” VÃ©rification de connexion AVANT d'afficher la page -->
<script>
if (localStorage.getItem("admin_logged") !== "true") {
    window.location.href = "login.html";
}
</script>

<header class="admin-header">
    <h1>VAFM â€“ Administration</h1>
    <h2 id="welcome"></h2>

    <nav class="admin-nav">
        <button data-section="actus">ActualitÃ©s</button>
        <button data-section="animateurs">Animateurs</button>
        <button data-section="emissions">Ã‰missions</button>
    </nav>
</header>

<!-- ðŸ”“ DÃ©connexion -->
<button class="logout-btn" onclick="logout()">DÃ©connexion</button>

<script>
function logout() {
    localStorage.removeItem("admin_logged");
    localStorage.removeItem("admin_user");
    window.location.href = "login.html";
}
</script>

<!-- ðŸ”¥ Script qui affiche "Salut Hugo !" APRÃˆS que l'Ã©lÃ©ment existe -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const user = localStorage.getItem("admin_user");
    if (user) {
        document.getElementById("welcome").textContent = "Salut " + user + " !";
    }
});
</script>

<main id="admin-content">

    <!-- ACTUALITÃ‰S -->
    <section id="actus" class="admin-section">
        <h2>Gestion des actualitÃ©s</h2>
        <button class="add-btn" id="add-actu">+ Ajouter une actualitÃ©</button>
        <div id="actus-list" class="admin-list"></div>
    </section>

    <!-- MODAL ACTUALITÃ‰ -->
    <div id="actu-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Nouvelle actualitÃ©</h3>

            <form id="actu-form">
                <input type="text" id="actu-titre" placeholder="Titre de l'actualitÃ©" required>
                <textarea id="actu-texte" placeholder="Texte de l'actualitÃ©" required></textarea>
                <input type="date" id="actu-date">
                <input type="file" id="actu-image" accept="image/*">

                <div class="modal-actions">
                    <button type="submit">Enregistrer</button>
                    <button type="button" id="close-modal">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ANIMATEURS -->
    <section id="animateurs" class="admin-section">
        <h2>Gestion des animateurs</h2>
        <button class="add-btn" id="add-animateur">+ Ajouter un animateur</button>
        <div id="animateurs-list" class="admin-list"></div>
    </section>

    <!-- POPUP ANIMATEUR -->
    <div id="popup-animateur" class="popup-overlay">
        <div class="popup">
            <h2 id="popup-animateur-title">Nouvel animateur</h2>

            <label>Nom de lâ€™animateur</label>
            <input type="text" id="animateur-nom">

            <label>Ã‰mission associÃ©e</label>
            <input type="text" id="animateur-emission">

            <label>Description</label>
            <textarea id="animateur-description"></textarea>

            <label>Photo de lâ€™animateur</label>
            <div id="drop-zone" class="drop-zone">
                <p>Glissez une image ici ou cliquez pour parcourir</p>
                <input type="file" id="animateur-image" accept="image/*">
            </div>

            <img id="preview-image" class="preview-image hidden">

            <div class="popup-buttons">
                <button id="popup-animateur-save" class="btn-primary">Enregistrer</button>
                <button id="popup-animateur-cancel" class="btn-secondary">Annuler</button>
            </div>
        </div>
    </div>

    <!-- POPUP EMISSION -->
    <div id="popup-emission" class="popup-overlay">
        <div class="popup">
            <h2 id="popup-emission-title">Nouvelle Ã©mission</h2>

            <label>Nom de lâ€™Ã©mission</label>
            <input type="text" id="emission-nom">

            <label>Horaires</label>
            <input type="text" id="emission-horaires" placeholder="Ex : Lundi 18h - 20h">

            <label>Description</label>
            <textarea id="emission-description"></textarea>

            <div class="popup-buttons">
                <button id="popup-emission-save" class="btn-primary">Enregistrer</button>
                <button id="popup-emission-cancel" class="btn-secondary">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Ã‰MISSIONS -->
    <section id="emissions" class="admin-section">
        <h2>Gestion des Ã©missions</h2>
        <button class="add-btn" id="add-emission">+ Ajouter une Ã©mission</button>
        <div id="emissions-admin" class="admin-list"></div>
    </section>

</main>
    
<script type="module" src="./admin.js"></script>
</body>
</html>
